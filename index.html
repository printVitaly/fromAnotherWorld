<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Игра в Блэкджек</title>
    <style>
        body, html {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #eee;
            margin: 0;
            padding: 0;
        }
        #menu, #gameArea {
            padding: 20px;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #dealerCards, #playerCards {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        .card {
            width: 60px;
            height: 90px;
            background-color: #fff;
            border-radius: 10px;
            border: 1px solid #000;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            position: relative;
            color: #333;
        }
        .red { color: red; }
        .black { color: black; }
        .card::before, .card::after {
            content: attr(data-suit);
            position: absolute;
            font-size: 10px;
        }
        .card::before {
            top: 5px;
            left: 5px;
        }
        .card::after {
            bottom: 5px;
            right: 5px;
        }
        .hidden-card {
            background-color: #000;
            border-color: #000;
            color: #fff;
            font-size: 24px;
        }
        .result {
            font-size: 24px;
            margin: 20px;
            font-weight: bold;
        }
        .lose { color: red; }
        .win { color: green; }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Блэкджек</h1>
        <div>Ваши монеты: <span id="coins">1000</span></div>
        <button onclick="startGame()">Start Game</button>
        <button onclick="addFunds()">Add Funds</button>
        <button onclick="showLeaderboard()">Top Players</button>
        <button onclick="showRules()">Правила</button>
    </div>
    <div id="gameArea" style="display:none;">
        <div id="dealerArea">
            <h2>Карты дилера</h2>
            <div id="dealerCards"></div>
        </div>
        <div id="playerArea">
            <h2>Ваши карты</h2>
            <div id="playerCards"></div>
        </div>
        <button onclick="hit()">Hit</button>
        <button onclick="stand()">Stand</button>
        <button onclick="returnToMenu()">Вернуться в меню</button>
        <h2>Ваш счет: <span id="playerScore"></span></h2>
        <div id="result" class="result"></div>
    </div>
    <script>
        let coins = 1000;
        let dealerCards = [];
        let playerCards = [];
        let deck = [];
        let playerScore = 0;
        let betAmount = 1000;

        function startGame() {
            if (coins < betAmount) {
                alert("Недостаточно средств для начала игры.");
                return;
            }
            coins -= betAmount;
            document.getElementById('coins').innerText = coins;
            document.getElementById('menu').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            deck = createDeck();
            shuffleDeck(deck);
            dealerCards = [drawCard(), drawCard()];
            playerCards = [drawCard(), drawCard()];
            renderCards('initial');
            updateScores();
        }

        function addFunds() {
            coins += 1000;
            document.getElementById('coins').innerText = coins;
        }

        function showLeaderboard() {
            alert("Функционал лидеров не реализован.");
        }

        function showRules() {
            alert("Игрок и дилер получают по две карты. Цель игры - набрать 21 очко или близкое к этому число, не превышая его. Карты 'J', 'Q', 'K' стоят 10 очков, туз может стоить 1 или 11 очков, остальные карты соответствуют своему номиналу.");
        }

        function hit() {
            if (getTotal(playerCards) < 21) {
                playerCards.push(drawCard());
                renderCards();
                updateScores();
            }
            checkGameEnd();
        }

        function stand() {
            dealerTurn();
        }

        function dealerTurn() {
            while (getTotal(dealerCards) < 18) {
                dealerCards.push(drawCard());
            }
            renderCards('reveal');
            updateScores();
            checkGameEnd();
        }

        function getTotal(cards) {
            let total = 0;
            let aceCount = 0;
            cards.forEach(card => {
                if (card.rank === 'A') {
                    aceCount++;
                    total += 11;
                } else if (['J', 'Q', 'K'].includes(card.rank)) {
                    total += 10;
                } else {
                    total += parseInt(card.rank);
                }
            });
            while (total > 21 && aceCount > 0) {
                total -= 10;
                aceCount--;
            }
            return total;
        }

        function drawCard() {
            return deck.pop();
        }

        function createDeck() {
            const suits = ['♦️', '♣️', '♠️', '♥️'];
            const ranks = [2, 3, 4, 5, 6, 7, 8, 9, 10, 'J', 'Q', 'K', 'A'];
            const newDeck = [];
            suits.forEach(suit => {
                ranks.forEach(rank => {
                    let color = (suit === '♥️' || suit === '♦️') ? 'red' : 'black';
                    newDeck.push({ suit, rank, color });
                });
            });
            return newDeck;
        }

        function shuffleDeck(deck) {
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

        function renderCards(stage) {
            const dealerDiv = document.getElementById('dealerCards');
            dealerDiv.innerHTML = '';
            dealerCards.forEach((card, index) => {
                if (index === 1 && stage === 'initial') {
                    dealerDiv.innerHTML += '<div class="card hidden-card">✖️</div>';
                } else {
                    dealerDiv.innerHTML += '<div class="card ' + card.color + '" data-suit="' + card.suit + '">' + card.rank + '</div>';
                }
            });
            const playerDiv = document.getElementById('playerCards');
            playerDiv.innerHTML = '';
            playerCards.forEach(card => {
                playerDiv.innerHTML += '<div class="card ' + card.color + '" data-suit="' + card.suit + '">' + card.rank + '</div>';
            });
        }

        function updateScores() {
            playerScore = getTotal(playerCards);
            document.getElementById('playerScore').innerText = playerScore;
        }

        function checkGameEnd() {
            const playerTotal = getTotal(playerCards);
            const dealerTotal = getTotal(dealerCards);
            const resultDiv = document.getElementById('result');
            let gameEnded = false;

            if (playerTotal > 21) {
                resultDiv.innerHTML = '<span class="lose">ПОРАЖЕНИЕ</span>';
                gameEnded = true;
            } else if (dealerTotal > 21) {
                resultDiv.innerHTML = '<span class="win">ПОБЕДА</span>';
                gameEnded = true;
            } else if (playerTotal === 21 && playerCards.length === 2) {
                resultDiv.innerHTML = '<span class="win">БЛЭКДЖЕК! ПОБЕДА</span>';
                gameEnded = true;
            } else if (dealerTotal === 21 && dealerCards.length === 2) {
                resultDiv.innerHTML = '<span class="lose">БЛЭКДЖЕК у дилера! ПОРАЖЕНИЕ</span>';
                gameEnded = true;
            } else if (playerTotal < 21 && dealerTotal >= 18) {
                if (playerTotal > dealerTotal) {
                    resultDiv.innerHTML = '<span class="win">ПОБЕДА</span>';
                    gameEnded = true;
                } else if (playerTotal < dealerTotal) {
                    resultDiv.innerHTML = '<span class="lose">ПОРАЖЕНИЕ</span>';
                    gameEnded = true;
                } else {
                    resultDiv.innerHTML = 'НИЧЬЯ';
                }
            }

            if (gameEnded) {
                document.querySelector("#returnToMenu").style.display = 'block';
                document.getElementById('result').style.display = 'block';
            }
        }

        function returnToMenu() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
            document.querySelector("#returnToMenu").style.display = 'none';
            document.getElementById('result').style.display = 'none';
        }
    </script>
</body>
</html>
